<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>BraintreeUtils.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BraintreeClient3.html">BraintreeClient3</a><ul class='methods'><li data-type='method'><a href="BraintreeClient3.html#init">init</a></li></ul></li><li><a href="BraintreeUI3.html">BraintreeUI3</a><ul class='methods'><li data-type='method'><a href="BraintreeUI3.html#destroy">destroy</a></li><li data-type='method'><a href="BraintreeUI3.html#init">init</a></li><li data-type='method'><a href="BraintreeUI3.html#postInit">postInit</a></li></ul></li><li><a href="BraintreeUtils.html">BraintreeUtils</a><ul class='methods'><li data-type='method'><a href="BraintreeUtils.html#decodeToken">decodeToken</a></li><li data-type='method'><a href="BraintreeUtils.html#getAccountSettings">getAccountSettings</a></li><li data-type='method'><a href="BraintreeUtils.html#getAVSChallenges">getAVSChallenges</a></li><li data-type='method'><a href="BraintreeUtils.html#is3DSEnabled">is3DSEnabled</a></li><li data-type='method'><a href="BraintreeUtils.html#parseError">parseError</a></li><li data-type='method'><a href="BraintreeUtils.html#toBoolean">toBoolean</a></li></ul></li><li><a href="ConfiguredClass.html">ConfiguredClass</a><ul class='methods'><li data-type='method'><a href="ConfiguredClass.html#execModuleFn">execModuleFn</a></li><li data-type='method'><a href="ConfiguredClass.html#init">init</a></li></ul></li><li><a href="CustomUI.html">CustomUI</a><ul class='methods'><li data-type='method'><a href="CustomUI.html#postInit">postInit</a></li><li data-type='method'><a href="CustomUI.html#tokenizeCard">tokenizeCard</a></li></ul></li><li><a href="DropinUI.html">DropinUI</a><ul class='methods'><li data-type='method'><a href="DropinUI.html#init">init</a></li></ul></li><li><a href="GenericIntegration.html">GenericIntegration</a><ul class='methods'><li data-type='method'><a href="GenericIntegration.html#destroy">destroy</a></li><li data-type='method'><a href="GenericIntegration.html#on3DSFail">on3DSFail</a></li><li data-type='method'><a href="GenericIntegration.html#onBypass3DS">onBypass3DS</a></li><li data-type='method'><a href="GenericIntegration.html#onPaymentMethodReceived">onPaymentMethodReceived</a></li><li data-type='method'><a href="GenericIntegration.html#onReady">onReady</a></li><li data-type='method'><a href="GenericIntegration.html#processError">processError</a></li><li data-type='method'><a href="GenericIntegration.html#setFieldValue">setFieldValue</a></li><li data-type='method'><a href="GenericIntegration.html#submit">submit</a></li></ul></li><li><a href="HostedFieldsUI.html">HostedFieldsUI</a><ul class='methods'><li data-type='method'><a href="HostedFieldsUI.html#createFields">createFields</a></li><li data-type='method'><a href="HostedFieldsUI.html#postInit">postInit</a></li><li data-type='method'><a href="HostedFieldsUI.html#tokenizeCard">tokenizeCard</a></li></ul></li><li><a href="PayPalButtonUI.html">PayPalButtonUI</a><ul class='methods'><li data-type='method'><a href="PayPalButtonUI.html#destroy">destroy</a></li><li data-type='method'><a href="PayPalButtonUI.html#disablePaymentButton">disablePaymentButton</a></li><li data-type='method'><a href="PayPalButtonUI.html#enablePaymentButton">enablePaymentButton</a></li><li data-type='method'><a href="PayPalButtonUI.html#getButtonId">getButtonId</a></li><li data-type='method'><a href="PayPalButtonUI.html#hidePaymentMethod">hidePaymentMethod</a></li><li data-type='method'><a href="PayPalButtonUI.html#init">init</a></li><li data-type='method'><a href="PayPalButtonUI.html#postInit">postInit</a></li><li data-type='method'><a href="PayPalButtonUI.html#showPaymentMethod">showPaymentMethod</a></li><li data-type='method'><a href="PayPalButtonUI.html#teardownHTML">teardownHTML</a></li><li data-type='method'><a href="PayPalButtonUI.html#tokenize">tokenize</a></li></ul></li><li><a href="ThreeDSecure.html">ThreeDSecure</a><ul class='methods'><li data-type='method'><a href="ThreeDSecure.html#init">init</a></li><li data-type='method'><a href="ThreeDSecure.html#removeFrame">removeFrame</a></li><li data-type='method'><a href="ThreeDSecure.html#verifyCard">verifyCard</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">BraintreeUtils.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
/**
 * Helper utility class for Braintree
 * 
 * @class
 * @author Eugen Mihailescu
 * @license {@link https://www.gnu.org/licenses/gpl-3.0.txt|GPLv3}
 * @class
 * @since 1.0
 * @param {string}
 *            token - The base64 token that encapsulates the Braintree account settings.
 */
function BraintreeUtils(token) {
    var token = token;
    var that = this;

    /**
     * Convert the given argument to its true boolean value.
     * 
     * @since 1.0
     * @param {(string|number|boolean)}
     *            value - A boolean string value, a boolean value or a numeric value
     * 
     * @example BraintreeUtils.toBoolean("false"); // returns FALSE
     * 
     * BraintreeUtils.toBoolean(true); // returns TRUE
     * 
     * BraintreeUtils.toBoolean(1); // returns TRUE
     * 
     * @returns {boolean} Returns the true boolean value of argument
     */
    this.toBoolean = function(value) {
        return "true" === value || true === value || 1 === value;
    };

    /**
     * Decode a base64 Braintree encoded JSON-formatted token
     * 
     * @since 1.0
     * @param {string}
     *            token - The base64 Braintree encoded token
     * @return {Object} Returns a JSON object containing the info encoded within the given token on success, FALSE otherwise
     */
    this.decodeToken = function(token) {
        var result = false;
        if (token) {
            try {
                result = JSON.parse(window.atob(token));
            } catch (e) {
                console.log(e);
            }
        }

        return result;
    };

    var obj = this.decodeToken(token);

    /**
     * Check if the Braintree settings has 3DS enabled.
     * 
     * @since 1.0
     * @returns {boolean} - Returns TRUE on success, FALSE otherwise
     */
    this.is3DSEnabled = function() {
        var result = false;

        if (obj) {
            result = that.toBoolean(obj.threeDSecureEnabled);
        }

        return result;
    };

    /**
     * Check if the Braintree settings defines the given AVS rule name.
     * 
     * @since 1.0
     * @param {string=}
     *            value - The Braintree AVS challange name to check
     * @returns {(boolean|string[])} When value argument specified returns true|false if the value argument is within the
     *          Braintree AVS challanges, otherwise returns an array of Braintree AVS challanges
     */
    this.getAVSChallenges = function(value) {
        var result = [];

        if (obj) {
            if (Array.prototype.isPrototypeOf(obj.challenges)) {
                result = obj.challenges;
            } else {
                if (that.UNDEF !== typeof obj.challenges.postal_code) {
                    result.push('postal_code');
                }
                if (that.UNDEF !== typeof obj.challenges.street_address) {
                    result.push('street_address');
                }
                if (that.UNDEF !== typeof obj.challenges.cvv) {
                    result.push('cvv');
                }
            }
        }

        return "undefined" === typeof value ? result : result.indexOf(value) >= 0;
    };

    /**
     * Get the Braintree settings value associated with the given key.
     * 
     * @since 1.0
     * @param {string}
     *            key - The key which value is to be returned. To specify a nested key use the dot notation.
     * @returns {boolean|Object} Returns the value associate with the key on success, false otherwise
     * 
     * @example myBUtilInstance.getAccountSettings("paypal.currencyIsoCode"); // return "USD"
     */
    this.getAccountSettings = function(key) {
        var keys = key.split(".");
        var result = obj;

        keys.forEach(function(k) {
            if (!result[k]) {
                result = false;
                return;
            }
            result = result[k];
        });

        return result;
    };

    /**
     * Parse a Braintree.js v2|v3 SDK error and return a complete error message
     * 
     * @since 1.0
     * @param {string|Object}
     *            err - The error string|object to parse. When an Object is provided then it should be compatible with
     *            {@link https://github.com/braintree/braintree-web|Braintree.js} error.
     * @returns {string} Returns an error message for the given input argument
     */
    this.parseError = function(err) {
        if ("object" !== typeof err) {
            return err;
        }

        var msg = [ err.message ];

        // helper iterative function for nested field error messages
        var renderFieldErrors = function(err) {
            var result = "";
            err.forEach(function(field) {
                if (field.fieldErrors) {
                    result += field.field + "." + renderFieldErrors(field.fieldErrors);
                } else if (field.field) {
                    result = field.field + ":" + (field.message || "") + (field.code ? "(" + field.code + ")" : "") + "\n";
                }
            });
            return result;
        };

        if (err.details) {
            var fragments = [];
            if (err.details.originalError) {

                // SDKv3 error
                if (err.details.originalError.error) {
                    var tds = err.details.originalError.threeDSecureInfo ? "3DS:" : "";
                    var m = [ err.message ];

                    m.push(err.details.originalError.error.message);
                    msg.push(tds + m.join(" "));
                }

                var rawRequestError = err.details.originalError;

                if (rawRequestError.fieldErrors) {
                    fragments = rawRequestError.fieldErrors[0].fieldErrors;
                }
            } else if (err.details.fieldErrors) {
                fragments = err.details.fieldErrors;
            }

            if (fragments.lenght) {
                msg.push(renderFieldErrors(fragments));
            }

        }

        // HostedFields SDKv3 specific error
        if (err.code) {
            switch (err.code) {
            case "HOSTED_FIELDS_FIELDS_INVALID":
                msg.push(err.details.invalidFieldKeys.join(","));
                break;
            }
        }

        // SDKv2 kind of error
        if (err.type) {
            var statusCode = err.statusCode ? "[" + err.statusCode + "] " : "";
            switch (err.type) {
            case "CONFIGURATION":
            case "VALIDATION":
            case "SERVER":
                if (err.details.invalidFields) {
                    msg.push(statusCode + err.details.invalidFields.map(function(item) {
                        return item.fieldKey + (item.isEmpty ? "=?" : "");
                    }).join(","));
                } else if (err.details.fieldErrors) {
                    msg.push(statusCode + renderFieldErrors(err.details.fieldErrors));
                }
                break;
            }

        }

        return (err.type ? err.type + ":" : "") + msg.join("&lt;br>");
    };
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sat Feb 18 2017 20:35:18 GMT+0100 (CET) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
